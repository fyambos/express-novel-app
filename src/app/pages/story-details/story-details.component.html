<div *ngIf="isLoading" class="flex justify-center h-screen bg-gray-100 pt-4 dark:bg-gray-800">
  <div class="flex flex-col items-center w-full max-w-lg space-y-4 animate-pulse">
    <div class="w-full h-12 bg-gray-300 rounded dark:bg-gray-700"></div>
    <div class="w-3/4 h-4 bg-gray-300 rounded dark:bg-gray-700"></div>
    <div class="w-full h-48 bg-gray-300 rounded-lg dark:bg-gray-700"></div>
    <div class="w-full h-4 bg-gray-300 rounded dark:bg-gray-700"></div>
    <div class="w-full h-4 bg-gray-300 rounded dark:bg-gray-700"></div>
  </div>
</div>

<div *ngIf="story" class="container mx-auto p-4 text-center">
  <h1 class="text-3xl font-bold mb-4 text-blue-500">{{ story.title }}</h1>
  <p class="text-lg mb-2">By: <span class="font-semibold">{{ story.author.username }}</span></p>
  <div class="mb-4">
    <p class="text-gray-600 dark:text-gray-400">{{ story.summary }}</p>
  </div>
  <div class="mb-4 flex justify-between pr-20 pl-20 text-gray-700 dark:text-gray-300">
    <div class="flex flex-col items-center">
      <p class="font-semibold">Word Count</p>
      <p class="text-xl">{{ story.wordCount || 0 }}</p>
    </div>
    <div class="flex flex-col items-center">
      <p class="font-semibold">Chapters</p>
      <p class="text-xl">{{ story.chapters?.length }}</p>
    </div>
    <div class="flex flex-col items-center cursor-pointer" (click)="openLikesModal(story.likes)">
      <p class="font-semibold">Likes</p>
      <p class="text-xl">{{ story.likes?.length || 0 }}</p>
    </div>
  </div>
  <div class="flex flex-col"> 
    <h2 class="text-xl font-semibold mb-2">Chapters</h2>
    <div class="relative inline-block w-full">
      <button mat-button [matMenuTriggerFor]="chapterMenu" class="w-50 flex justify-between items-center dark:text-black dark:bg-gray-300 border rounded py-2 px-3 focus:outline-none">
        Select Chapter
        <mat-icon>arrow_drop_down</mat-icon>
      </button>
      <mat-menu #chapterMenu="matMenu" class="w-full">
        <button mat-menu-item (click)="onFullStoryRedirect(story._id)" class="text-blue-500 font-semibold">
          View Full Story
        </button>
        <button mat-menu-item *ngFor="let chapter of story.chapters" (click)="onChapterSelect(chapter._id)">
          Chapter {{ chapter.chapter }}: {{ chapter.title }}
        </button>
      </mat-menu>
    </div>
  </div>

  <div class="flex justify-center"> 
    <div class="text-center">
      <h2 class="text-xl font-semibold mb-2">Tags</h2>
      <div class="flex flex-wrap gap-2 justify-center">
        <span class="bg-gray-200 text-gray-700 px-2 py-1 rounded-md" *ngFor="let tag of story.tags">
          {{ tag }}
        </span>
      </div>
    </div>
  </div>
  

  <div *ngIf="isAuthor" class="mt-4">
    <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded mr-4" (click)="navigateToReorderChapters(story._id)">
      <i class="fas fa-grip-lines text-gray-500 dark:text-gray-400 mr-2"></i>
      Reorder Chapters
    </button>
    <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-4" (click)="openEditModal(story)">
      <i class="fas fa-edit mr-2"></i>
      Edit Story
    </button>
    <button class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded" (click)="openChapterModal(story._id)">
      <i class="fas fa-plus mr-2"></i>
      Add Chapter
    </button>
  </div>
</div>