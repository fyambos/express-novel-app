<div *ngIf="isLoading" class="flex justify-center h-screen bg-gray-100 pt-4 dark:bg-gray-800">
  <div class="flex flex-col items-center w-full max-w-lg space-y-4 animate-pulse">
    <div class="w-full h-12 bg-gray-300 rounded dark:bg-gray-700"></div>
    <div class="w-3/4 h-4 bg-gray-300 rounded dark:bg-gray-700"></div>
    <div class="w-full h-48 bg-gray-300 rounded-lg dark:bg-gray-700"></div>
    <div class="w-full h-4 bg-gray-300 rounded dark:bg-gray-700"></div>
    <div class="w-full h-4 bg-gray-300 rounded dark:bg-gray-700"></div>
  </div>
</div>

<div *ngIf="!isLoading && user" class="profile-container max-w-4xl mx-auto p-6 bg-white dark:bg-gray-800 rounded-md shadow-md">
  <div class="container mx-auto p-4">
    <div class="flex justify-center items-center">
      <img 
        [src]="user.profilePicture ? 'http://localhost:4200/assets/' + user.profilePicture : 'https://i.imgur.com/WxNkK7J.png'" 
        alt="Profile Picture" 
        class="rounded-full w-24 h-24 mb-4"
      >
    </div>

    <h1 class="text-2xl font-bold mb-2">{{ user.username }}</h1>
    <p class="text-gray-500 mb-4">{{ user.role }}</p>

    <div class="flex space-x-4 mb-4">
      <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Follow</button>
      <button  
        *ngIf="!isOwnProfile"  
        class="flex items-center justify-center text-white bg-blue-500 hover:bg-blue-600 px-3 py-2 rounded-md transition-colors duration-300" 
        (click)="sendMessage()" 
        aria-label="Send Message"
        >
        <i class="fas fa-envelope"></i>
      </button>
      <button *ngIf="isOwnProfile" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded" (click)="openEditDialog()">Edit Profile</button>
      <button *ngIf="isOwnProfile" class="bg-red-500 dark:bg-red-700 hover:bg-red-700 dark:hover:bg-red-800 text-white font-semibold py-2 px-4 rounded" (click)="deleteProfile(user.id)">Delete Profile</button>
    </div>

    <h2 class="text-xl font-semibold mb-2">Bio</h2>
    <p class="text-gray-500">{{ user.bio }}</p>

    <h2 class="text-xl font-semibold mb-2">Interests</h2>
    <div class="flex flex-wrap gap-2">
      <ng-container *ngIf="user.interests && user.interests.length > 0; else noInterests">
        <span *ngFor="let interest of user.interests" class="bg-gray-200 text-gray-700 px-2 py-1 rounded-md">
          {{ interest }}
        </span>
      </ng-container>
      <ng-template #noInterests>
        <p class="text-gray-500">No interests added yet.</p>
      </ng-template>
    </div>
    <div class="flex space-x-4 mb-4 mt-4 justify-center">
      <button (click)="viewBookmarks = 'stories'" [ngClass]="{'bg-blue-500 text-white': viewBookmarks === 'stories', 'bg-gray-200 text-gray-700': viewBookmarks !== 'stories'}" class="py-2 px-4 rounded">
        Stories
      </button>
      <button (click)="viewBookmarks = 'bookmarks'" [ngClass]="{'bg-blue-500 text-white': viewBookmarks === 'bookmarks', 'bg-gray-200 text-gray-700': viewBookmarks !== 'bookmarks'}" class="py-2 px-4 rounded">
        Bookmarks
      </button>
      <button (click)="viewBookmarks = 'read'" [ngClass]="{'bg-blue-500 text-white': viewBookmarks === 'read', 'bg-gray-200 text-gray-700': viewBookmarks !== 'read'}" class="py-2 px-4 rounded">
        Read
      </button>
    </div>
    <div *ngIf="viewBookmarks === 'bookmarks'" class="mb-4">
      <app-bookmarks
        [bookmarks]="bookmarks"
        [actionType]="'bookmark'"
        >
      </app-bookmarks>
    </div>
    <div *ngIf="viewBookmarks === 'stories'" class="mb-4">
      <h2 class="text-xl font-semibold mb-4">Stories
        {{ stories.length > 0 ? '(' + stories.length + ')' : '' }}
      </h2>
      <ng-container *ngIf="stories && stories.length > 0; else noStories">
        <app-story-card *ngFor="let story of stories" [story]="story"></app-story-card>
      </ng-container>
      <ng-template #noStories>
        <p class="text-gray-500">This author has not written any stories yet.</p>
      </ng-template>
    </div>
    <div *ngIf="viewBookmarks === 'read'" class="mb-4">
      <app-bookmarks
        [bookmarks]="reads"
        [actionType]="'read'"
        >
      </app-bookmarks>
    </div>
  </div>
</div>

<div *ngIf="!isLoading && !user && !errorMessage" class="text-center">
  <p>User not found.</p>
</div>

<div *ngIf="errorMessage" class="text-center text-red-500">
  <p>{{ errorMessage }}</p>
</div>
